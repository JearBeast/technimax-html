!function(t,e){"function"==typeof define&&define.amd?define(e):"object"==typeof exports?module.exports=e():t.Blazy=e()}(this,function(){"use strict";var u,r,f,d="src",p="srcset";return function(t){if(!document.querySelectorAll){var i=document.createStyleSheet();document.querySelectorAll=function(t,e,o,n,s){for(s=document.all,e=[],o=(t=t.replace(/\[for\b/gi,"[htmlFor").split(",")).length;o--;){for(i.addRule(t[o],"k:v"),n=s.length;n--;)s[n].currentStyle.k&&e.push(s[n]);i.removeRule(0)}return e}}var e=this,o=e._util={};o.elements=[],o.destroyed=!0,e.options=t||{},e.options.error=e.options.error||!1,e.options.offset=e.options.offset||100,e.options.root=e.options.root||document,e.options.success=e.options.success||!1,e.options.selector=e.options.selector||".b-lazy",e.options.separator=e.options.separator||"|",e.options.container=!!e.options.container&&document.querySelectorAll(e.options.container),e.options.errorClass=e.options.errorClass||"b-error",e.options.breakpoints=e.options.breakpoints||!1,e.options.loadInvisible=e.options.loadInvisible||!1,e.options.successClass=e.options.successClass||"b-loaded",e.options.validateDelay=e.options.validateDelay||25,e.options.saveViewportOffsetDelay=e.options.saveViewportOffsetDelay||50,e.options.srcset=e.options.srcset||"data-srcset",e.options.src=u=e.options.src||"data-src",f=1<window.devicePixelRatio,(r={}).top=0-e.options.offset,r.left=0-e.options.offset,e.revalidate=function(){n(this)},e.load=function(t,e){var o=this.options;void 0===t.length?a(t,e,o):E(t,function(t){a(t,e,o)})},e.destroy=function(){var t=this,e=t._util;t.options.container&&E(t.options.container,function(t){T(t,"scroll",e.validateT)}),T(window,"scroll",e.validateT),T(window,"resize",e.validateT),T(window,"resize",e.saveViewportOffsetT),e.count=0,e.elements.length=0,e.destroyed=!0},o.validateT=l(function(){s(e)},e.options.validateDelay,e),o.saveViewportOffsetT=l(function(){c(e.options.offset)},e.options.saveViewportOffsetDelay,e),c(e.options.offset),E(e.options.breakpoints,function(t){if(t.width>=window.screen.width)return u=t.src,!1}),setTimeout(function(){n(e)})};function n(t){var e=t._util;e.elements=function(t){for(var e=[],o=t.root.querySelectorAll(t.selector),n=o.length;n--;e.unshift(o[n]));return e}(t.options),e.count=e.elements.length,e.destroyed&&(e.destroyed=!1,t.options.container&&E(t.options.container,function(t){b(t,"scroll",e.validateT)}),b(window,"resize",e.saveViewportOffsetT),b(window,"resize",e.validateT),b(window,"scroll",e.validateT)),s(t)}function s(t){for(var e,o=t._util,n=0;n<o.count;n++){var s=o.elements[n];void 0,((e=s.getBoundingClientRect()).right>=r.left&&e.bottom>=r.top&&e.left<=r.right&&e.top<=r.bottom||g(s,t.options.successClass))&&(t.load(s),o.elements.splice(n,1),o.count--,n--)}0===o.count&&t.destroy()}function a(e,t,o){if(!g(e,o.successClass)&&(t||o.loadInvisible||0<e.offsetWidth&&0<e.offsetHeight))if(r=e.getAttribute(u)||e.getAttribute(o.src)){var n=r.split(o.separator),s=n[f&&1<n.length?1:0],i=w(e,"img");if(i||void 0===e.src){var r,a=new Image,c=function(){o.error&&o.error(e,"invalid"),y(e,o.errorClass),T(a,"error",c),T(a,"load",l)},l=function(){if(i){h(e,p,o.srcset);var t=e.parentNode;t&&w(t,"picture")&&E(t.getElementsByTagName("source"),function(t){h(t,p,o.srcset)}),m(e,s)}else e.style.backgroundImage='url("'+s+'")';v(e,o),T(a,"load",l),T(a,"error",c)};b(a,"error",c),b(a,"load",l),(r=e.getAttribute(o.srcset))&&(a[p]=r),m(a,s)}else m(e,s),v(e,o)}else w(e,"video")?(E(e.getElementsByTagName("source"),function(t){h(t,d,o.src)}),e.load(),v(e,o)):(o.error&&o.error(e,"missing"),y(e,o.errorClass))}function v(e,t){y(e,t.successClass),t.success&&t.success(e),e.removeAttribute(t.src),E(t.breakpoints,function(t){e.removeAttribute(t.src)})}function m(t,e){t[d]=e}function h(t,e,o){var n=t.getAttribute(o);n&&(t[e]=n,t.removeAttribute(o))}function w(t,e){return t.nodeName.toLowerCase()===e}function g(t,e){return-1!==(" "+t.className+" ").indexOf(" "+e+" ")}function y(t,e){g(t,e)||(t.className+=" "+e)}function c(t){r.bottom=(window.innerHeight||document.documentElement.clientHeight)+t,r.right=(window.innerWidth||document.documentElement.clientWidth)+t}function b(t,e,o){t.attachEvent?t.attachEvent&&t.attachEvent("on"+e,o):t.addEventListener(e,o,{capture:!1,passive:!0})}function T(t,e,o){t.detachEvent?t.detachEvent&&t.detachEvent("on"+e,o):t.removeEventListener(e,o,{capture:!1,passive:!0})}function E(t,e){if(t&&e)for(var o=t.length,n=0;n<o&&!1!==e(t[n],n);n++);}function l(e,o,n){var s=0;return function(){var t=+new Date;t-s<o||(s=t,e.apply(n,arguments))}}});